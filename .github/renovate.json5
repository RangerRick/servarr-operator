{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:recommended',
    ':configMigration',
    ':disableDependencyDashboard',
    'customManagers:helmChartYamlAppVersions',
    ':semanticCommitTypeAll(build)',
  ],

  // General Settings
  assigneesFromCodeOwners: true,
  baseBranchPatterns: [
    'main',
  ],
  branchConcurrentLimit: 5,
  internalChecksFilter: 'strict',
  labels: [
    'dependencies',
  ],
  minimumReleaseAge: '7 days',
  postUpdateOptions: [
    'gomodTidy',
    'helmUpdateSubChartArchives',
    'npmDedupe',
  ],
  prCreation: 'not-pending',
  prHourlyLimit: 0,
  rangeStrategy: 'bump',

  // Specific Package Rules
  packageRules: [
    {
      groupName: 'Helm Chart Support',
      groupSlug: 'helm-charts',
      matchManagers: [
        'helmv3',
      ],
      versioning: 'helm',
    },
    {
      groupName: 'auto-merge non-major dependencies',
      groupSlug: 'all-non-major',
      matchUpdateTypes: [
        '!major',
      ],
      automerge: true,
    },
    {
      groupName: 'auto-merge developer dependencies',
      groupSlug: 'dev-dependencies',
      matchDepTypes: [
        'devDependencies',
      ],
      automerge: true,
    },

    // Group Rust crate updates together
    {
      groupName: 'Rust Dependencies',
      groupSlug: 'rust-deps',
      matchManagers: [
        'cargo',
      ],
      matchUpdateTypes: [
        '!major',
      ],
    },

    // Rust toolchain version (from custom regex manager)
    {
      groupName: 'Rust Toolchain',
      groupSlug: 'rust-toolchain',
      matchDepNames: [
        'rust',
      ],
      matchManagers: [
        'custom.regex',
      ],
    },

    // Container image versions in image-defaults.toml
    {
      groupName: 'Servarr App Images',
      groupSlug: 'servarr-images',
      matchFileNames: [
        'image-defaults.toml',
      ],
    },
  ],

  // Custom managers for non-standard dependency sources
  customManagers: [
    // Rust toolchain version in rust-toolchain.toml
    {
      customType: 'regex',
      managerFilePatterns: [
        '/(^|/)rust-toolchain\\.toml$/',
      ],
      matchStrings: [
        'channel\\s*=\\s*"(?<currentValue>\\d+\\.\\d+(\\.\\d+)?)"',
      ],
      depNameTemplate: 'rust',
      packageNameTemplate: 'rust-lang/rust',
      datasourceTemplate: 'github-releases',
    },

    // Container image tags in image-defaults.toml
    //
    // Rust base image in Dockerfile (already handled by dockerfile manager,
    // but this ensures the rust-toolchain.toml and Dockerfile stay grouped)
    {
      customType: 'regex',
      managerFilePatterns: [
        '/(^|/)image-defaults\\.toml$/',
      ],
      matchStrings: [
        '\\[(?<depName>[a-z]+)\\]\\nrepository\\s*=\\s*"(?<packageName>[^"]+)"\\ntag\\s*=\\s*"(?<currentValue>[^"]+)"',
      ],
      datasourceTemplate: 'docker',
    },
  ],

  // handle charts + template files as "Kubernetes" manager type
  kubernetes: {
    managerFilePatterns: [
      '/^chart\\/.+\\.ya?ml$/',
      '/^charts\\/.+\\.ya?ml$/',
    ],
  },
}
